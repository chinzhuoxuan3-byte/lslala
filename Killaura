local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

local KILLAURA_ENABLED = false
local RANGE = 14
local ATTACK_DELAY = 0.10
local lastAttackTime = 0
local WEAPON_NAME = "Axe"
local GUI_VISIBLE = true

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local MainToggle = Instance.new("TextButton")
MainToggle.Size = UDim2.new(0, 55, 0, 55)
MainToggle.Position = UDim2.new(0.85, 0, 0.08, 0)
MainToggle.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainToggle.Text = "LS"
MainToggle.TextColor3 = Color3.fromRGB(255, 170, 0)
MainToggle.TextSize = 20
MainToggle.Font = Enum.Font.GothamBold
MainToggle.Parent = ScreenGui

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 12)
ToggleCorner.Parent = MainToggle

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 200, 0, 160)
Frame.Position = UDim2.new(0.5, -100, 0.5, -80)
Frame.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
Frame.BorderSizePixel = 0
Frame.Visible = false
Frame.Parent = ScreenGui

local FrameCorner = Instance.new("UICorner")
FrameCorner.CornerRadius = UDim.new(0, 10)
FrameCorner.Parent = Frame

local dragging, dragStart, startPos

local function setupDrag(gui)
    gui.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = gui.Position
        end
    end)
    gui.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            gui.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    UIS.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
end

setupDrag(MainToggle)
setupDrag(Frame)

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 35)
Title.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Title.Text = "Ls Hub"
Title.TextColor3 = Color3.fromRGB(255, 170, 0)
Title.TextSize = 18
Title.Font = Enum.Font.GothamBold
Title.Parent = Frame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 10)
TitleCorner.Parent = Title

local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Size = UDim2.new(0.85, 0, 0, 45)
ToggleBtn.Position = UDim2.new(0.075, 0, 0.28, 0)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
ToggleBtn.Text = "Killaura: OFF"
ToggleBtn.TextColor3 = Color3.new(1, 1, 1)
ToggleBtn.TextSize = 16
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.Parent = Frame

local ToggleBtnCorner = Instance.new("UICorner")
ToggleBtnCorner.CornerRadius = UDim.new(0, 8)
ToggleBtnCorner.Parent = ToggleBtn

local WeaponBtn = Instance.new("TextButton")
WeaponBtn.Size = UDim2.new(0.85, 0, 0, 30)
WeaponBtn.Position = UDim2.new(0.075, 0, 0.58, 0)
WeaponBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
WeaponBtn.Text = "Weapon: " .. WEAPON_NAME
WeaponBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
WeaponBtn.TextSize = 14
WeaponBtn.Font = Enum.Font.Gotham
WeaponBtn.Parent = Frame

local WeaponBtnCorner = Instance.new("UICorner")
WeaponBtnCorner.CornerRadius = UDim.new(0, 6)
WeaponBtnCorner.Parent = WeaponBtn

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(0.85, 0, 0, 25)
StatusLabel.Position = UDim2.new(0.075, 0, 0.8, 0)
StatusLabel.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
StatusLabel.Text = "Ready"
StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 120)
StatusLabel.TextSize = 12
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Parent = Frame

local StatusCorner = Instance.new("UICorner")
StatusCorner.CornerRadius = UDim.new(0, 6)
StatusCorner.Parent = StatusLabel

MainToggle.MouseButton1Click:Connect(function()
    GUI_VISIBLE = not GUI_VISIBLE
    Frame.Visible = GUI_VISIBLE
end)

local function isDangerousCore(obj)
    if not obj then return false end
    
    local current = obj
    while current and current ~= workspace do
        if current.Name == "m_Zombie" or current:FindFirstChild("Barrel", true) or current.Parent == workspace:FindFirstChild("Camera") then
            return true
        end
        current = current.Parent
    end
    
    local cam = workspace:FindFirstChild("Camera")
    if cam then
        for _, b in pairs(cam:GetChildren()) do
            if b.Name == "m_Zombie" and b:FindFirstChild("Barrel", true) then
                local bRoot = b:FindFirstChild("HumanoidRootPart") or b:FindFirstChild("Torso")
                local objPos = (obj:IsA("BasePart") and obj.Position) or (obj:FindFirstChild("HumanoidRootPart") and obj.HumanoidRootPart.Position)
                
                if bRoot and objPos and (bRoot.Position - objPos).Magnitude < 3 then
                    return true
                end
            end
        end
    end

    return false
end

local function getRemote()
    local pFolder = workspace.Players:FindFirstChild(LocalPlayer.Name)
    local weapon = pFolder and pFolder:FindFirstChild(WEAPON_NAME)
    return weapon and weapon:FindFirstChild("RemoteEvent")
end

local function findTarget()
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return nil end
    local myPos = char.HumanoidRootPart.Position
    
    local zombiesFolder = workspace:FindFirstChild("Zombies")
    if not zombiesFolder then return nil end
    
    local closest = nil
    local minDist = RANGE
    
    for _, z in pairs(zombiesFolder:GetChildren()) do
        if z:IsA("Model") then
            if not isDangerousCore(z) then
                local head = z:FindFirstChild("Head")
                local root = z:FindFirstChild("HumanoidRootPart") or z:FindFirstChild("Torso")
                local hum = z:FindFirstChildOfClass("Humanoid")
                
                if head and root and hum and hum.Health > 0 then
                    local d = (myPos - root.Position).Magnitude
                    if d < minDist then
                        closest = z
                        minDist = d
                    end
                end
            end
        end
    end
    return closest
end

local function attack(target)
    if isDangerousCore(target) then return end
    
    local now = tick()
    if now - lastAttackTime < ATTACK_DELAY then return end
    
    local remote = getRemote()
    if not remote then return end
    
    local char = LocalPlayer.Character
    local head = target:FindFirstChild("Head")
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not head or not hrp then return end
    
    local dir = (head.Position - hrp.Position).Unit
    
    pcall(function()
        remote:FireServer("Swing", "Side")
        remote:FireServer("HitZombie", target, head.Position, true, dir * 12, "Head", dir)
    end)
    
    lastAttackTime = now
    StatusLabel.Text = "Attacking..."
end

ToggleBtn.MouseButton1Click:Connect(function()
    KILLAURA_ENABLED = not KILLAURA_ENABLED
    ToggleBtn.Text = "Killaura: " .. (KILLAURA_ENABLED and "ON" or "OFF")
    ToggleBtn.BackgroundColor3 = KILLAURA_ENABLED and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(200, 50, 50)
    StatusLabel.Text = KILLAURA_ENABLED and "Active" or "Ready"
end)

RunService.Heartbeat:Connect(function()
    if KILLAURA_ENABLED then
        local t = findTarget()
        if t then attack(t) end
    end
end)
